- name: Adding EPGs to AEP using REST API
  uri:
    url: "{{ apic_url }}/api/node/mo/uni/tn-{{ item.tenant | trim }}/ap-{{ item.app_profile | trim }}/epg-{{ item.epg | trim }}/rsDomAtt-[uni/phys-{{ item.aep | trim }}].json"
    method: POST
    user: "{{ apic_username }}"
    password: "{{ apic_password }}"
    validate_certs: no
    force_basic_auth: yes
    headers:
      Content-Type: application/json
    body_format: json
    body:
      fvRsDomAtt:
        attributes:
          tDn: "uni/phys-{{ item.aep | trim }}"
          encap: "{{ item.encap_id | trim }}"
          instrImedcy: "{{ item.interface_mode | trim }}"
          status: "created,modified"
    status_code: 200
  when: (item.epg | trim) != ""

- name: Pause after EPG creation
  pause:
    seconds: 1
  when: (item.epg | trim) != ""