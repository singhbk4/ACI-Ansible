- name: Adding Ethernet Port in Interface Selector Profile using aci_rest
  aci_rest:
    host: "{{ apic_url }}"
    username: "{{ apic_username }}"
    password: "{{ apic_password }}"
    validate_certs: false
    method: post
    path: /api/node/mo/uni/infra/accportprof-{{ leaf_int_selector_profile | trim }}/hports-{{ interface_name | trim }}-typ-range.json
    content:
      infraHPortS:
        attributes:
          dn: uni/infra/accportprof-{{ leaf_int_selector_profile | trim }}/hports-{{ interface_name | trim }}-typ-range
          name: "{{ interface_name | trim }}"
          rn: hports-{{ interface_name | trim }}-typ-range
          status: created,modified
        children:
          - infraPortBlk:
              attributes:
                dn: >-
                  uni/infra/accportprof-{{ leaf_int_selector_profile | trim }}/hports-{{ interface_name | trim }}-typ-range/portblk-block2
                fromPort: "{{ from_port | int }}"
                toPort: "{{ to_port | int }}"
                name: block2
                rn: portblk-block2
                status: created,modified
              children: []
          - infraRsAccBaseGrp:
              attributes:
                tDn: uni/infra/funcprof/brkoutportgrp-{{ policy_group | trim }}
                status: created,modified
              children: []
  delegate_to: localhost
  when: (item.leaf_int_selector_profile | trim) != ""

- name: Pause after EPG creation
  pause:
    seconds: 1
  when: (item.leaf_int_selector_profile | trim) != ""